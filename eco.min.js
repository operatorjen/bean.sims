(()=>{var g=Math.random,kt=["b","d","f","g","h","j","k","l","m","n","p","r","s","t","v","w","z","ch","sh","th","qu"],At=["a","e","i","o","u","ai","ou","ei","ua"],It=["an","el","is","on","ar","en","as","in","or","us","ia","eo","y","u"],pe=e=>e[g()*e.length|0],wt=e=>e.replace(/\b\w/g,t=>t.toUpperCase()),Te=()=>{let e="",t=g()<.5?2:3;for(;t-- >1;)e+=pe(kt)+pe(At);return wt(e+pe(It))},Tt=[{m:500,M:600,ch:.5,add:.15},{m:600,M:700,ch:.75,add:.13},{m:700,M:800,ch:.85,add:.11},{m:800,M:900,ch:.95,add:.08}];function Ve(e){let t=e.income/10,a=ae(e);a>0&&(t+=a/5);let i={type:"Credit Card",amount:0,limit:t,interestAccrued:0},n=L()+g()*.05,l=Tt.find(o=>e.creditScore>=o.m&&e.creditScore<o.M);return i.interestRate=n+(l&&g()<l.ch?l.add:.08),e.liabilities.credit[Date.now()]=i,e}function $e(e){let t=m(),a=t.adjustedRentalRate;if(e.creditScore>500&&!Object.keys(e.liabilities.rentals).length){let i=Math.floor(g()*2e3+1e3)*(1+a);if(e.assets.cash>=i){let n=z.generateId();n&&(e.assets.cash-=i,e.liabilities.rentals[`ren_${n}`]={type:"Rental",amount:i,rentalInsurance:Math.floor(g()*15+15)*(1+t.inflationRate)})}}return e}function fe(e,t){return z.releaseId(t),delete e.liabilities.rentals[t],e}function je(e){let t=m(),a=t.rules.vehicleRules,i=L()+g()*.05,n=Math.floor((g()*15e4+5e3)*(1+t.adjustedVehicleRate)*(1+i)),l=n;if(e.creditScore>750){let o=Z.generateId();if(o){let s=Object.values(a).find(h=>n<=h.priceMax)||a.superLuxury;l-=s.depreciationOffLot*l;let r=`veh_${o}`;e.assets.vehicles[r]={purchaseValue:n,age:0,currentValue:l,maintenanceRisk:s.maintenanceRisk,accidentMultiplier:0,health:1},e.liabilities.loans[r]={name:`Vehicle loan ${r}`,amount:(n+n*i)/12,amountOwing:n,interestRate:i,interestAccrued:0,principalPaid:0},Object.keys(e.assets.vehicles).length>1&&g()>.5&&ge(e,Object.keys(e.assets.vehicles)[g()*Object.keys(e.assets.vehicles).length|0]),t.totalVehicles++}}return e}function Le(e){let t=m(),a=L()-g()*.05,i=g()*3e3+400|0,n=Math.floor(i*(g()*1e3+200))*(1+t.adjustedVehicleRate)*(1+a),l=n*.25;if(e.assets.cash>=l&&$(e)>n){let o=ve.generateId(),s=0;if(o){let r=`prop_${o}`;e.assets.realEstate[r]={purchaseValue:n,size:i,currentValue:n,rentalIncome:0,propertyTaxes:(g()*3+3)*i,health:1},t.totalRealEstate++,e.liabilities.unitFees[r]={amount:.3*i|0},Object.keys(e.assets.realEstate).length>1&&(e.assets.realEstate[r].rentalIncome=i*(g()*L())+.8),e.liabilities.mortgages[r]={amount:n-l,interestRate:a,interestAccrued:0,principalPaid:0,downPayment:l},e.assets.cash-=l}}return e}function ge(e,t){let a=m(),i=e.assets.vehicles[t].currentValue*a.adjustedVehicleRate*.05;return a.totalTaxes+=i,e.assets.cash+=e.assets.vehicles[t].currentValue*(1+a.adjustedVehicleRate)-i,Z.releaseId(t),delete e.assets.vehicles[t],e}function G(e,t){let a=m(),i=e.assets.realEstate[t].currentValue,n=e.liabilities.mortgages[t]?.amount||0,l=i*a.adjustedRealEstateRate*.1;return a.totalTaxes+=l,e.assets.cash+=i*(1+a.adjustedRealEstateRate)-n-l,ve.releaseId(t),delete e.liabilities.mortgages[t],delete e.liabilities.unitFees[t],e}function Ne(e){let t=150001+L();return g()<F(e)&&(t+=g()*2e4),g()<S(e)&&(t+=g()*5e3),e.income=t/24|0,e}function ye(e){return e.income=0,e}function De(e){let t=O.generateId();return t&&(e[`pet_${t}`]={age:0,health:1}),e}function Fe(e){let t=m();return g()<t.reproductionChance&&g()<e.reproducibility&&e.pregnant<1&&(e.pregnant=1,e.relationships.spouseWithChild=e.relationships.spouse),e}function _e(e){e.liabilities.healthInsurance=g()*500+50|0;for(let t in e.dependents||{})e.liabilities.healthInsurance+=100;return e}function Oe(e){return e.liabilities.healthInsurance=0,e}function U(e=null){let t=Pe();if(!t.id)return!1;if(e)Object.assign(t,e,{reproducibility:.95,x:e.x||g()*500+30,y:e.y||g()*500+30,vx:0,vy:0});else{let a=t.age;t.reproducibility=a<25?.8:a<30?.6:a<35?.5:a<40?.25:a<45?.05:0,t.x=t.y=t.vx=t.vy=0,t.name=Te(),t.relationships.parents=[],t.health=S(t)*g()+.1}return _(t),t}function We(e,t){let a=xe.generateId();if(a){let i=N(t),n=i?(e.conditions.anxiety+i.conditions.anxiety)/2:g(),l=i?(e.conditions.immunity+i.conditions.immunity)/2:g(),o={physical:(e.traits.physical+(i?.traits?.physical||0))/2,mental:(e.traits.mental+(i?.traits?.mental||0))/2,spiritual:(e.traits.spiritual+(i?.traits?.spiritual||0))/2},s={id:`sim_${a}`,name:Te(),age:0,conditions:{anxiety:n,immunity:l,health:1},traits:o,birthYear:te(),birthDay:A(),relationships:{parents:[],spouse:"",children:[],siblings:[]}};s.relationships.parents.push(t),e.relationships.children.push(s.id),e.dependents||(e.dependents={}),e.dependents[s.id]=s,e.pregnant=0}return e}function ee(e){let t=[e.traits.physical,e.traits.mental,e.traits.spiritual],a=t.filter(o=>o>.75).length,i=t.filter(o=>o>.45).length,n=t.filter(o=>o>.25).length,l=t.filter(o=>o>0).length;return a===3?.9:a===2?.8:a===1&&i===3?.7:i===3?.6:i===2?.5:n>=2?.4:n>=1?.3:l===3?.2:.1}function S(e){let[t,a]=[e.traits.physical,e.traits.mental],i=[.85,.75,.9,.75,.65,.8,.7,.55,.7,.6,.45,.6,.5,.35,.5,.4,.25,.4,.3,.15,.3,.2,0,.1],n=0;for(;n<i.length&&!(t>i[n]&&a>i[n+1]);)n+=3;return i[n+2]||.1}function F(e){let t=[e.traits.physical,e.traits.mental,e.traits.spiritual],a=[.8,.75,.8,.9,.7,.65,.7,.8,.6,.55,.6,.7,.5,.45,.5,.6,.4,.35,.4,.5,.35,.25,.35,.4,.25,.15,.25,.3,.15,.05,.15,.2],i=0;for(;i<a.length&&!(t[0]>a[i]&&t[1]>a[i+1]&&t[2]>a[i+2]);)i+=4;return a[i+3]||.1}function He(e){let t=k();for(let a in t)if(![...e.relationships.parents,...e.relationships.siblings,...e.relationships.children].includes(a)&&!e.relationships.spouse&&a!==e.id){let i=N(a),n=0;for(let l of["physical","mental","spiritual"])Math.abs(i.traits[l]-e.traits[l])<.08&&n++;if(n>1){e.relationships.spouse=a;break}}return e}var v=Math.random,K=1,Be=new Date().getFullYear(),qe=Math.floor(v()*50+10),I={},Vt=0,x={simulationSpeed:1,inflationRate:parseFloat(inflationRate.value)||3,reproductionChance:.75,averageAgeDeath:0,totalTaxes:0,realEstateCap:100,rentalCap:300,vehicleCap:500,petsCap:300,totalRealEstate:0,totalVehicles:0,totalBirths:0,totalMedicalFees:0,totalVetFees:0,totalDiscretionary:0,totalCloning:0,pathogenChance:0,pathogenThreshold:0,adjustedRealEstateRate:0,adjustedVehicleRate:0,adjustedRentalRate:0,zoomLevel:1,rules:{vehicleRules:{nonLuxury:{priceMax:45e3,depreciationOffLot:v()*(.2-.15)+.15,depreciationFirstYear:v()*(.2-.15)+.15,depreciation:v()*(.15-.1)+.1,maintenanceRisk:v()*(.2-.05)+.05},luxury:{priceMax:12e4,depreciationOffLot:v()*(.15-.1)+.1,depreciationFirstYear:v()*(.15-.1)+.1,depreciation:v()*(.1-.05)+.05,maintenanceRisk:v()*(.15-.03)+.03},superLuxury:{priceMax:1e7,depreciationOffLot:v()*(.1-.1)+.05,depreciationFirstYear:v()*(.1-.05)+.05,depreciation:v()*(.07-.02)+.02,maintenanceRisk:v()*(.2-.05)+.05}},propertyRules:{lower:{priceMax:35e4,maintenanceRisk:v()*(.2-.05)+.05},middle:{priceMax:15e5,maintenanceRisk:v()*(.15-.03)+.03},upper:{priceMax:35e5,maintenanceRisk:v()*(.1-.02)+.02},high:{priceMax:1e8,maintenanceRisk:v()*(.2-.05)+.05}},incomeTaxRules:{lower:{maxIncome:2e4,taxRate:0},middle:{maxIncome:8e4,taxRate:v()*(.28-.17)+.17},upper:{maxIncome:2e5,taxRate:v()*(.45-.31)+.31},high:{maxIncome:1e8,taxRate:v()*(.5-.37)+.37}}}};[["simulationSpeed",e=>x.simulationSpeed=+e,e=>`${x.simulationSpeed}x`],["inflationRate",e=>x.inflationRate=+e,e=>`${(x.inflationRate*100).toFixed(2)}%`],["reproductionChance",e=>x.reproductionChance=+e,e=>`${(x.reproductionChance*100).toFixed(0)}%`],["pathogenThreshold",e=>x.pathogenThreshold=+e,e=>x.pathogenThreshold],["pathogenChance",e=>x.pathogenChance=+e,e=>`${(x.pathogenChance*100).toFixed(2)}%`],["realEstateCap",e=>x.realEstateCap=+e,e=>x.realEstateCap],["rentalCap",e=>x.rentalCap=+e,e=>x.rentalCap],["vehicleCap",e=>x.vehicleCap=+e,e=>x.vehicleCap],["petsCap",e=>x.petsCap=+e,e=>x.petsCap]].forEach(([e,t,a])=>{let i=document.querySelector(`#${e}`),n=document.querySelector(`#${e}Friendly`);n.textContent=a(),i.addEventListener("change",l=>{t(l.target.value),n.textContent=a()})});var L=()=>x.inflationRate,m=()=>x;var A=()=>K+1,te=()=>Be;var Me=()=>qe;function Ye(){return K++,K===361&&(Be++,qe+=1+x.inflationRate,K=1),K}var _=e=>I[e.id]=e,k=()=>I;var N=e=>I[e]||!1;function Ge(e){Vt++;let t=I[e];for(let a in t.assets.realEstate)G(t,a);for(let a in t.assets.vehicles)ge(t,a);for(let a in t.pets)O.releaseId(a);for(let a in t.liabilities.rentals)z.releaseId(a);return x.averageAgeDeath=(x.averageAgeDeath+t.age)/2,delete I[e],I}function Ue(){let e=0,t=0;for(let a in I){let i=$(I[a]);I[a].netWorth=i,!isNaN(i)&&(e+=i,t++)}return t?e/t|0:0}function Ze(){let e=0,t=0;for(let a in I){let i=I[a].income*24;!isNaN(i)&&(e+=i,t++)}return t?e/t|0:0}var $t=1,E=Math.random,xe={generateId:()=>crypto.randomUUID()},W=m(),ze=W.vehicleCap,ie=new Set,Z={generateId:()=>{if(W.adjustedVehicleRate>0&&(W.adjustedVehicleRate=Math.max(0,W.adjustedVehicleRate-E()*5e-4)),ie.size>=ze)return W.adjustedVehicleRate<.01&&(W.adjustedVehicleRate+=E()*.001),!1;let e=0;for(;ie.has(e);)e=(e+1)%ze;return ie.add(e)&&e},releaseId:e=>ie.delete(e)},H=m(),Ke=H.realEstateCap,ne=new Set,ve={generateId:()=>{if(H.adjustedRealEstateRate>0&&(H.adjustedRealEstateRate=Math.max(0,H.adjustedRealEstateRate-E()*.05)),ne.size>=Ke)return H.adjustedRealEstateRate<.02&&(H.adjustedRealEstateRate+=E()*.003),!1;let e=0;for(;ne.has(e);)e=(e+1)%Ke;return ne.add(e)&&e},releaseId:e=>ne.delete(e)},P=m(),Qe=P.rentalCap,re=new Set,z={generateId:()=>{if(P.adjustedRentalRate>0&&(P.adjustedRentalRate=Math.min(0,P.adjustedRentalRate-E()*.05)),re.size>=Qe)return P.adjustedRentalRate<.06&&(P.adjustedRentalRate+=E()*.006),!1;let e=0;for(;re.has(e);)e=(e+1)%Qe;return re.add(e)&&e},releaseId:e=>re.delete(e)},jt=m(),Xe=jt.petsCap,le=new Set,O={generateId:()=>{if(le.size>=Xe)return!1;let e=0;for(;le.has(e);)e=(e+1)%Xe;return le.add(e)&&e},releaseId:e=>le.delete(e)};function B(){let e,t;do e=E();while(!e);do t=E();while(!t);let a=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t);return a=a/10+.5,a>1||a<0?B():a}function Pe(){let e=E()*4+1|0,t=E(),a=E(),i=E(),n=B(),l=B(),o=B(),s=(E()*50|0)+20,r=xe.generateId();return r?{vx:0,vy:0,id:`sim_${r}`,name:"",income:1e4/e/24|0,conditions:{anxiety:t,immunity:a,health:i},infected:!1,age:s,creditScore:E()*500+300|0,birthYear:new Date().getFullYear()-s,birthDay:(E()*360|0)+1,reproducibility:0,pregnant:0,pets:{},relationships:{spouse:"",parents:[],children:[],siblings:[]},dependents:{},traits:{physical:n,mental:l,spiritual:o},netWorth:0,assets:{cash:B()*1e4|0,investments:B()*1e4|0,realEstate:{},vehicles:{}},liabilities:{rentals:{},unitFees:{},mortgages:{},credit:{},loans:{},healthInsurance:0}}:!1}var Re=()=>$t;function ae(e){let t=0;for(let a in e.credit){let i=e.credit[a].limit-e.credit[a].amount;i>0&&(t+=i)}return t}function $(e){let t=e.assets.cash+e.assets.investments;for(let a in e.assets.realEstate){let i=e.assets.realEstate[a].amount;!isNaN(i)&&(t+=i)}for(let a in e.assets.vehicles){let i=e.assets.vehicles[a].currentValue;!isNaN(i)&&(t+=i)}for(let a in e.liabilities.mortgages){let i=e.liabilities.mortgages[a].amount;!isNaN(i)&&(t-=i)}for(let a in e.liabilities.credit){let i=e.liabilities.credit[a].amount;!isNaN(i)&&(t-=i)}for(let a in e.liabilities.loans){let i=e.liabilities.loans[a].amountOwing;!isNaN(i)&&(t-=i)}return t}function w(e,t){for(let a in e.liabilities.credit){let i=e.liabilities.credit[a];if(i.limit-i.amount>=t)return i.amount+=t,e}return null}var Q="http://www.w3.org/2000/svg",be=e=>[...""+e].reduce((t,a)=>(t<<5)-t+a.charCodeAt(0)|0,0),Lt=e=>{let t=e>>>0;return()=>(t=t*1664525+1013904223>>>0)/4294967296},Ee=e=>Lt(be(e)),Nt=e=>new Date().getFullYear()-e;function se(e,t=60){let{traits:a,conditions:i,birthYear:n}=e,l=Ee(`${a.physical}${a.mental}${a.spiritual}${i.anxiety}${i.health}`),o=t/2,s=Nt(n),r=document.createElementNS(Q,"svg"),h=a.physical+a.mental+a.spiritual+i.anxiety+i.health,u=30+50*i.anxiety|0;r.setAttribute("class","avatar"),r.setAttribute("viewBox",`0 0 ${t} ${t}`),r.setAttribute("width",t),r.setAttribute("height",t);let p=document.createElementNS(Q,"polygon"),M=Array.from({length:u},(V,R)=>{let C=-Math.PI/2+2*Math.PI*R/u,J=t*.35+l()*i.anxiety*(1-a.physical)*t*.175+a.physical*t*.105;return`${o+Math.cos(C)*J},${o+Math.sin(C)*J}`}).join(" ");p.setAttribute("points",M),p.setAttribute("fill",`hsl(${Math.floor(h*82)},${80+l()*120}%,${60+l()*20}%)`),r.appendChild(p);let f=o*.8+(s<20?-4:s>60?4:0),d=t*(.03+a.mental*.07);[-1,1].forEach(V=>{let R=document.createElementNS(Q,"g"),C=document.createElementNS(Q,"ellipse");R.setAttribute("transform",`translate(${o+V*d*3.5},${f})`),C.setAttribute("rx",d),C.setAttribute("ry",d*(.6+l()*.35)),C.setAttribute("fill","black"),R.appendChild(C),r.appendChild(R)});let y=document.createElementNS(Q,"ellipse");return y.setAttribute("cx",o),y.setAttribute("cy",o+t*.05+(s<20?-5:s>60?5:0)),y.setAttribute("rx",t*(.04*i.anxiety)+l()*t/4),y.setAttribute("ry",t*(.08*i.anxiety)+l()*t*a.mental*.1),y.setAttribute("fill","rgba(75,5,16,0.94)"),r.appendChild(y),r}function Je(e,t,a=60){if(!e||!e.parentNode)return;let i=se(t,a);return i.setAttribute("class","avatar"),e.parentNode.replaceChild(i,e),i}var Dt=[.75,.5,.25,0],Ft=["physical","mental","spiritual"],oe={physical:[["\u{1F94B}","\u{1F4BB}","\u{1F680}","\u{1F371}","\u{1F3AD}","\u{1F3C5}","\u{1F451}","\u{1F48E}","\u263A\uFE0F","\u{1F913}","\u{1F601}","\u{1F914}","\u{1F9D8}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FB}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FC}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FD}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FE}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FF}\u200D\u2642\uFE0F","\u{1F6B4}\u200D\u2642\uFE0F","\u{1F6F3}\uFE0F"],["\u{1F3DA}\uFE0F","\u{1F62B}","\u2639\uFE0F","\u{1F92E}","\u{1F974}","\u{1F92C}","\u{1F621}","\u{1F62D}","\u{1F61F}","\u{1FAE9}","\u{1F480}","\u{1F3B0}","\u{1F92A}","\u{1F917}","\u{1F3AE}","\u263A\uFE0F","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F64F}","\u{1F64F}\u{1F3FB}","\u{1F64F}\u{1F3FC}","\u{1F64F}\u{1F3FD}","\u{1F64F}\u{1F3FE}","\u{1F64F}\u{1F3FF}","\u{1F54C}","\u{1F54D}","\u26EA","\u{1F6F8}","\u{1F52E}"]],mental:[["\u{1F94B}","\u{1F4BB}","\u{1F680}","\u{1F371}","\u{1F3AD}","\u{1F3C5}","\u{1F451}","\u{1F48E}","\u263A\uFE0F","\u{1F913}","\u{1F601}","\u{1F914}","\u{1F9D8}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FB}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FC}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FD}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FE}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FF}\u200D\u2642\uFE0F","\u{1F6B4}\u200D\u2642\uFE0F","\u{1F6F3}\uFE0F"],["\u{1F3DA}\uFE0F","\u{1F62B}","\u2639\uFE0F","\u{1F92E}","\u{1F974}","\u{1F92C}","\u{1F621}","\u{1F62D}","\u{1F61F}","\u{1FAE9}","\u{1F480}","\u{1F3B0}","\u{1F92A}","\u{1F917}","\u{1F3AE}","\u263A\uFE0F","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F64F}","\u{1F64F}\u{1F3FB}","\u{1F64F}\u{1F3FC}","\u{1F64F}\u{1F3FD}","\u{1F64F}\u{1F3FE}","\u{1F64F}\u{1F3FF}","\u{1F54C}","\u{1F54D}","\u26EA","\u{1F6F8}","\u{1F52E}"]],spiritual:[["\u{1F62B}","\u2639\uFE0F","\u{1F917}","\u{1F61F}","\u{1FAE9}","\u{1F92E}","\u{1F64F}","\u{1F64F}\u{1F3FB}","\u{1F64F}\u{1F3FC}","\u{1F64F}\u{1F3FD}","\u{1F64F}\u{1F3FE}","\u{1F64F}\u{1F3FF}","\u{1F54C}","\u{1F54D}","\u26EA","\u{1F3B0}","\u{1F6F8}","\u{1F3AE}","\u263A\uFE0F","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F52E}","\u{1F3AD}","\u{1F4BB}","\u{1F3C5}","\u{1F6F3}\uFE0F","\u{1F451}","\u{1F48E}","\u{1F913}","\u{1F601}","\u{1F914}","\u{1F9D8}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FB}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FC}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FD}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FE}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FF}\u200D\u2642\uFE0F","\u{1F6B4}\u200D\u2642\uFE0F","\u{1F371}"],["\u{1F62B}","\u2639\uFE0F","\u{1F92C}","\u{1F92E}","\u{1F621}","\u{1F62D}","\u{1F61F}","\u{1FAE9}","\u{1F64F}","\u{1F64F}\u{1F3FB}","\u{1F64F}\u{1F3FC}","\u{1F64F}\u{1F3FD}","\u{1F64F}\u{1F3FE}","\u{1F64F}\u{1F3FF}","\u{1F3B0}","\u{1F3AE}","\u263A\uFE0F","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F52E}","\u{1F3AD}","\u{1F4BB}","\u{1F3C5}","\u{1F451}","\u{1F48E}","\u{1F680}","\u{1F913}","\u{1F601}","\u{1F914}","\u{1F9D8}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FB}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FC}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FD}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FE}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FF}\u200D\u2642\uFE0F","\u{1F6B4}\u200D\u2642\uFE0F","\u{1F371}"],["\u{1F3DA}\uFE0F","\u{1F62B}","\u2639\uFE0F","\u{1F92E}","\u{1F974}","\u{1F92C}","\u{1F621}","\u{1F62D}","\u{1F61F}","\u{1FAE9}","\u{1F480}","\u{1F3B0}","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F3AD}","\u{1F4BB}","\u{1F3C5}","\u{1F451}","\u{1F48E}","\u{1F680}","\u263A\uFE0F","\u{1F913}","\u{1F601}","\u{1F914}","\u{1F9D8}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FB}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FC}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FD}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FE}\u200D\u2642\uFE0F","\u{1F9D8}\u{1F3FF}\u200D\u2642\uFE0F","\u{1F6B4}\u200D\u2642\uFE0F","\u{1F371}"],["\u{1F3DA}\uFE0F","\u{1F62B}","\u2639\uFE0F","\u{1F92E}","\u{1F974}","\u{1F92C}","\u{1F621}","\u{1F62D}","\u{1F61F}","\u{1FAE9}","\u{1F480}","\u{1F3B0}","\u{1F92A}","\u{1F354}","\u{1F36B}","\u{1F37A}","\u{1F94B}","\u{1F4BB}","\u{1F680}","\u{1F371}"]]},et=e=>{if(e.conditions.anxiety<.2)return"";let t=Ft.reduce((l,o)=>e.traits[l]>=e.traits[o]?l:o),a=e.traits[t],i=Dt.findIndex(l=>a>=l),n=i<oe[t].length?i:oe[t].length-1;return oe[t][n][Math.random()*oe[t][n].length|0]};var q=e=>document.getElementById(e),tt=e=>document.querySelector(e),_t=()=>document.createDocumentFragment(),j={community:tt("#community"),details:tt("#details"),cloner:q("cloner"),currentDate:q("currentdate"),stats:["population","deathAvg","netWorthAvg","incomeAvg","totalTaxes","totalRealEstate","totalVehicles","totalBirths","totalMedicalFees","totalVetFees","totalDiscretionary","totalCloning","adjustedRealEstateRate","adjustedRentalRate","adjustedVehicleRate"],friendly:{population:"Adult Population: ",deathAvg:"Average Age of Death: ",netWorthAvg:"Net Worth Average: ",incomeAvg:"Average Annual Income: ",totalTaxes:"Taxes Collected: ",totalRealEstate:"Real Estate Purchased: ",totalVehicles:"Vehicles Purchased: ",totalBirths:"Total Births: ",totalMedicalFees:"Total Medical Fees: ",totalVetFees:"Total Vet Fees: ",totalDiscretionary:"Total Discretionary Spent: ",totalCloning:"Total Cloned: ",adjustedRealEstateRate:"Real Estate Markup: ",adjustedRentalRate:"Rental Markup: ",adjustedVehicleRate:"Vehicle Resell Markup: "}};j.cloner.addEventListener("click",e=>{e.preventDefault();let t=k();if(Object.keys(t).length>99)return e.target.textContent="Max Population Reached";e.target.textContent="Clone BeanSims x 3";let a=0;for(let i=0;i<3;i++){let n=U();n&&(a++,_(n),he(n))}m().totalCloning+=3});function at(e,t){j.currentDate.textContent=`${e} / Day ${t} of 360`}function it(){let e=m(),t=k(),a=n=>n.toLocaleString("en-US"),i={population:Object.keys(t).length,deathAvg:Math.floor(e.averageAgeDeath),netWorthAvg:Ue(),incomeAvg:Ze(),totalTaxes:Math.floor(e.totalTaxes),totalRealEstate:e.totalRealEstate,totalVehicles:e.totalVehicles,totalBirths:e.totalBirths,totalMedicalFees:Math.floor(e.totalMedicalFees),totalVetFees:Math.floor(e.totalVetFees),totalDiscretionary:Math.floor(e.totalDiscretionary),totalCloning:Math.floor(e.totalCloning),adjustedRealEstateRate:(e.adjustedRealEstateRate*100).toFixed(2)+"%",adjustedRentalRate:(e.adjustedRentalRate*100).toFixed(2)+"%",adjustedVehicleRate:(e.adjustedVehicleRate*100).toFixed(2)+"%"};j.stats.forEach(n=>{let l=q(n);l.textContent=j.friendly[n]+a(i[n])})}function ce(e,t,a,i){let n=e.querySelector(t);n.innerHTML="";let l=_t();a.forEach(o=>{let s=document.createElement("span");s.textContent=i(o),l.appendChild(s)}),n.appendChild(l)}function Ce(e,t){let a=q(e.id);if(!a)return;a.classList.toggle("infected",e.infected),a.style.zIndex=Math.floor(Math.random()*3),Je(a.querySelector(".avatar"),e);let i=a.querySelector(".status"),n=et(e)||e.relationships.spouse&&"\u{1F60D}"||"";i.classList.toggle("active",!!n),i.innerHTML=n?`<div>${n}</div>`:"";let l=a.querySelector(".pregnancy");if(e.pregnant>0&&!l){let h=document.createElement("div");h.className="pregnancy",h.style.background=a.style.background,a.appendChild(h)}else e.pregnant===0&&l&&l.remove();let o=a.querySelector(".stats"),s=[];e.netWorth>1e7?s.push("\u{1F4B0}\u{1F4B0}\u{1F4B0}"):e.netWorth>1e6?s.push("\u{1F4B0}\u{1F4B0}"):e.netWorth>5e5&&s.push("\u{1F4B0}"),e.traits.mental>.75?s.push("\u{1F9E0}\u{1F9E0}\u{1F9E0}"):e.traits.mental>.6&&s.push("\u{1F9E0}");let r=["\u{1F4AA}","\u{1F4AA}\u{1F3FB}","\u{1F4AA}\u{1F3FC}","\u{1F4AA}\u{1F3FD}","\u{1F4AA}\u{1F3FE}","\u{1F4AA}\u{1F3FE}"][Math.random()*6|0];if(e.traits.physical>.75?s.push(r+r+r):e.traits.physical>.55&&s.push(r),o.innerHTML=s.map(h=>`<div>${h}</div>`).join(""),t){let h=j.details,u=m();h.querySelector(".name").textContent=`${e.name}, ${e.age}`,h.querySelector(".networth").textContent=`Net Worth: ${Math.floor(e.netWorth).toLocaleString()}`,h.querySelector(".creditscore").textContent=`Credit Score: ${e.creditScore}`,ce(h,".rentalsview",Object.keys(e.liabilities.rentals),f=>"\u{1F3D8}\uFE0F"),ce(h,".realestateview",Object.keys(e.assets.realEstate),f=>"\u{1F3E1}"),ce(h,".vehiclesview",Object.keys(e.assets.vehicles),f=>{let d=e.assets.vehicles[f].purchaseValue,y=u.rules.vehicleRules;return d>=y.luxury.priceMax?"\u{1F3CE}\uFE0F":d>=y.nonLuxury.priceMax?"\u{1F699}":"\u{1F6FB}"}),ce(h,".petsview",Object.keys(e.pets),f=>Math.random()>.5?"\u{1F638}":"\u{1F436}");let p=e.relationships.children,M=h.querySelector(".relationshipview");M.innerHTML="",p.forEach(f=>{let d=N(f)||e.dependents[f];if(!d)return;let y=document.createElement("div");y.className="dependent";let V=se(d,30),R=document.createElement("div");R.className="info",R.textContent=`${d.name}, ${d.age}`,y.append(V,R),M.appendChild(y),V.addEventListener("mouseover",()=>y.classList.add("active")),V.addEventListener("mouseout",()=>y.classList.remove("active"))})}}function nt(e){let t=q(e);t&&t.remove()}function rt(e,t){let a=document.body,i=e/t,n=[{top:[9,9,136],bot:[20,30,50]},{top:[25,63,167],bot:[43,129,204]},{top:[245,200,73],bot:[243,100,33]},{top:[217,61,144],bot:[18,84,216]}],l=n.length,o=1/l,s=Math.floor(i/o),r=(i-s*o)/o,h=(f,d,y)=>f+(d-f)*y,u=f=>f.map((d,y)=>Math.round(h(n[s%l].top[y],n[(s+1)%l].top[y],r))),p=`rgb(${u([0,1,2]).join(",")})`,M=`rgb(${u([0,1,2]).join(",")})`;a.style.background=`linear-gradient(0deg, ${p}, ${M})`}function he(e){if(q(e.id))return;let t=document.createElement("div");t.id=e.id,t.className="view adult";let a=e.traits.physical+e.traits.mental+e.traits.spiritual+e.conditions.anxiety+e.conditions.health,i=Ee(be(a)^Math.floor(a*1e6)),n=Math.floor(a*110/5*360),l=`hsl(${n},${90+i()*30}%,${20+i()*20}%)`,o=`hsl(${n},${90+i()*30}%,${20+i()*20}%)`;t.style.background=`linear-gradient(45deg, ${l}, ${o})`;let s=se(e),r=document.createElement("div");r.className="stats";let h=document.createElement("div");h.className="status";let u=document.createElement("div");u.className="hover",u.dataset.id=e.id;let p=document.createElement("div");p.className="dependents",t.append(s,r,h,u,p),u.addEventListener("mouseover",()=>Ce(N(e.id),!0)),u.addEventListener("mouseout",()=>j.details.classList.remove("active")),e.x=e.x||Math.random()*j.community.clientWidth,e.y=e.y||Math.random()*j.community.clientHeight,t.style.transform=`translate(${e.x}px,${e.y}px) scale(${m().zoomLevel})`,j.community.appendChild(t)}var Ot=[[1,0],[-1,0],[0,1],[0,-1]],Y=new Map,X=new Map,lt=0;function ot(e){let t=new Map;for(let a of Object.values(e)){let i=Math.floor(a.x/150),n=Math.floor(a.y/150),l=`${i},${n}`;t.set(l,(t.get(l)||0)+1)}for(let[a,i]of t.entries())i>=2&&Y.set(a,(Y.get(a)||0)+i);for(let[a,i]of Y.entries()){let n=i*.95;n<1?Y.delete(a):Y.set(a,n)}}function ct(e){e-lt<200||(lt=e,Wt())}function Wt(){let e=[...Y.entries()].filter(([,n])=>n>=20).map(([n])=>n),t=new Set(e);for(let n of X.keys())if(!t.has(n)){let{base:l,center:o}=X.get(n);roads.removeChild(l),roads.removeChild(o),X.delete(n)}if(e.length===0)return;let a=Ht(e),i=document.createDocumentFragment();a.forEach(n=>{let l=n.map(h=>{let[u,p]=h.split(",").map(Number);return{x:u*150+75,y:p*150+75}}),o=Pt(l);if(o.length<2)return;let s=Bt(o),r=n[0];if(!X.has(r)){let h=st(s,45,"rgba(127, 127, 127, 0.99)"),u=st(s,12,"white","30,30");i.append(h,u),X.set(r,{base:h,center:u})}}),roads.appendChild(i)}function st(e,t,a,i){let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill","none"),n.setAttribute("stroke",a),n.setAttribute("stroke-width",t),n.setAttribute("stroke-linecap","round"),i&&n.setAttribute("stroke-dasharray",i),n}function Ht(e=[]){if(!Array.isArray(e)||e.length===0)return[];let t=new Set(e),a=new Set,i=[];for(let n of e){if(a.has(n))continue;let l=[],o=[n];a.add(n);let s=0;for(;s<o.length;){let r=o[s++];l.push(r);let[h,u]=r.split(",").map(Number);Ot.forEach(([p,M])=>{let f=`${h+p},${u+M}`;t.has(f)&&!a.has(f)&&(a.add(f),o.push(f))})}i.push(l)}return i}function Pt(e){let t=[],a=e.slice(),i=a.shift();for(t.push(i);a.length;){let n=0,l=1/0;a.forEach((o,s)=>{let r=o.x-i.x,h=o.y-i.y,u=r*r+h*h;u<l&&(l=u,n=s)}),i=a.splice(n,1)[0],t.push(i)}return t}function Bt(e){let t=`M${e[0].x},${e[0].y}`;for(let a=0;a<e.length-1;a++){let i=e[a-1]||e[a],n=e[a],l=e[a+1],o=e[a+2]||l,s=n.x+(l.x-i.x)/6,r=n.y+(l.y-i.y)/6,h=l.x-(o.x-n.x)/6,u=l.y-(o.y-n.y)/6;t+=` C${s},${r} ${h},${u} ${l.x},${l.y}`}return t}var ue=250,qt=.2,Yt=5,Se="http://www.w3.org/2000/svg";function ht(){buildingsLayer.innerHTML="";let e=new Map,t=k();for(let a in t){let i=t[a],n=Math.floor(i.x/ue),l=Math.floor(i.y/ue),o=`${n},${l}`;e.has(o)||e.set(o,[]),e.get(o).push(i)}for(let[a,i]of e.entries()){if(i.length<Yt)continue;let n=i.map(p=>p.netWorth),l=n.reduce((p,M)=>p+M,0)/n.length,o=Math.sqrt(n.map(p=>(p-l)**2).reduce((p,M)=>p+M,0)/n.length),s=parseInt(a.split(",")[0])*ue,r=parseInt(a.split(",")[1])*ue,h="apartment";o<qt*l&&(l<3e5?h="tent":l<15e5?h="village":h="modern");let u;switch(h){case"village":u=Gt(s,r);break;case"apartment":u=Ut(s,r);break;case"modern":u=Zt(s,r);break;case"tent":u=zt(s,r);break}buildingsLayer.appendChild(u)}}function Gt(e,t){let a=me(),i=de(e+30,t+50,50,50,"#c49d77"),n=D([[e+25,t+50],[e+55,t+20],[e+85,t+50]],"#874e1b");return a.append(i,n),a}function Ut(e,t){let a=me(),i=de(e+40,t+20,40,80,"#333");a.appendChild(i);for(let l=0;l<6;l++)for(let o=0;o<6;o++){let s=de(e+45+o*5,t+25+l*10,4,4,"#eee");a.appendChild(s)}let n=de(e+55,t+89,10,10,"#000");return a.appendChild(n),a}function Zt(e,t){let a=me(),i=D([[e,t+40],[e+40,t+20],[e+40,t+70],[e,t+90]],"#999"),n=D([[e+40,t+20],[e+80,t+40],[e+80,t+90],[e+40,t+70]],"#666"),l=D([[e,t+40],[e+40,t+20],[e+80,t+40],[e+40,t+60]],"#aaa");return a.append(i,n,l),a}function zt(e,t){let a=me(),i=D([[e+50,t+30],[e+90,t+80],[e+60,t+80]],"#d6c03c"),n=D([[e+20,t+80],[e+80,t+80],[e+50,t+30]],"#f7e463"),l=D([[e+20,t+80],[e+50,t+30],[e+40,t+80]],"#e0c645"),o=D([[e+48,t+80],[e+50,t+50],[e+52,t+80]],"#d2b83d");return a.append(i,n,l,o),a}function me(){return document.createElementNS(Se,"g")}function de(e,t,a,i,n){let l=document.createElementNS(Se,"rect");return l.setAttribute("x",e),l.setAttribute("y",t),l.setAttribute("width",a),l.setAttribute("height",i),l.setAttribute("fill",n),l}function D(e,t){let a=document.createElementNS(Se,"polygon");return a.setAttribute("points",e.map(i=>i.join(",")).join(" ")),a.setAttribute("fill",t),a}var ut=.5,dt=50,Kt=20,Qt=1.5,Xt=1.5,Jt=1e7,T=Math.random;function ea(e){let t=k(),a={},i={};Object.keys(t).forEach(n=>{a[n]=0,i[n]=0;let l=t[n];if(l){let o=l.traits.physical;a[n]+=ut*o*e+(T()-.5)*dt*e,i[n]+=ut*o*e+(T()-.5)*dt*e,l.netWorth=$(l)}});for(let n in t){let l=t[n];if(!l)continue;let{x:o,y:s,traits:r}=l,h=r.physical,u=r.mental,p=r.spiritual,M=l.netWorth||0;for(let f in t)if(f>n){let d=t[f];if(!d)continue;d.netWorth=$(d);let y=d.x-o,V=d.y-s,R=y*y+V*V;if(!R||!isFinite(R))continue;let C=Math.sqrt(R),J=y/C,Mt=V/C;C<m().pathogenThreshold&&T()<m().pathogenChance&&(l.infected&&!d.infected&&T()>S(d)?(d.infected=1,d.conditions.anxiety+=T()*.1,d.conditions.immunity-=T()*.05,d.conditions.health-=T()*.05):d.infected&&!l.infected&&T()>S(l)&&(l.infected=1,l.conditions.anxiety+=T()*.1,l.conditions.immunity-=T()*.05,l.conditions.health-=T()*.05)),C<5&&(d.conditions.anxiety=(d.conditions.anxiety*7+l.conditions.anxiety*3)/10,d.traits.mental=(d.traits.mental*7+l.traits.mental*3)/10,d.traits.spiritual=(d.traits.spiritual*7+l.traits.spiritual*3)/10,l.conditions.anxiety=(d.conditions.anxiety*3+l.conditions.anxiety*7)/10,l.traits.mental=(d.traits.mental*3+l.traits.mental*7)/10,l.traits.spiritual=(l.traits.spiritual*7+d.traits.spiritual*3)/10);let Rt=d.netWorth,bt=1-Math.min(1,Math.abs(M-Rt)/Jt),Et=1-Math.min(1,Math.abs(u-d.traits.mental)/2),Ct=1-Math.min(1,Math.abs(l.conditions.anxiety-d.conditions.anxiety)/2),St=1-Math.min(1,Math.abs(p-d.traits.spiritual)/2),Ae=(h*d.traits.physical+u*d.traits.mental+p*d.traits.spiritual)/R*(.1+.5*bt*Et*Ct*St)-(R<Xt?Kt/Math.pow(R,Qt):0),Ie=Ae*J,we=Ae*Mt;a[n]+=Ie,i[n]+=we,a[f]-=Ie,i[f]-=we}}return{ax:a,ay:i}}function mt(){let e=m(),t=k(),{ax:a,ay:i}=ea(e.simulationSpeed),n=.95**(140/e.simulationSpeed),l=document.querySelector("#community"),o=l.clientWidth,s=l.clientHeight;Object.values(t).forEach(r=>{r.vx=(r.vx+a[r.id])*n,r.vy=(r.vy+i[r.id])*n,r.x+=r.vx,r.y+=r.vy;let h=document.getElementById(r.id);if(!h)return;let u=h.offsetWidth,p=h.offsetHeight,M=o-u,f=s-p;r.x<0?(r.x=0,r.vx=-r.vx*1.8):r.x>M&&(r.x=M,r.vx=-r.vx*1.8),r.y<0?(r.y=0,r.vy=-r.vy*1.8):r.y>f&&(r.y=f,r.vy=-r.vy*1.8),h.style.transform=`translate(${r.x}px,${r.y}px) scale(${e.zoomLevel})`,ot(t),ct(performance.now()),ht()})}var c=Math.random,ta=He,aa=Ve,pt=N,ft=5e5,b=m(),ia=18,gt=L(),ke=0;for(let e=0;e<10;e++){let t=U();t&&(_(t),he(t))}function na(e){let t=e*24,{incomeTaxRules:{lower:a,middle:i,upper:n,high:l},progressiveTaxation:o}=m().rules;if(o){let r=t,h=0,u;return u=Math.min(r,a.maxIncome),h+=u*a.taxRate,r-=u,r<=0||(u=Math.min(r,i.maxIncome-a.maxIncome),h+=u*i.taxRate,r-=u,r<=0)||(u=Math.min(r,n.maxIncome-i.maxIncome),h+=u*n.taxRate,r-=u,r<=0)||(h+=r*l.taxRate),h/24}let s=t<=a.maxIncome?a:t<=i.maxIncome?i:t<=n.maxIncome?n:l;return t*s.taxRate/24}function Ka(e,t){let a=(e.income+1+c()*F(e))*(1+t);return e.income=(a>ft?ft:a)/24|0,e}function ra(){return Re()===1?c()*.21-.03:Re()===2?c()*.23-.07:c()*.25-.15}function yt(e){let t=0,a=e.conditions;a.anxiety>.7&&(t+=c()*50),a.immunity<.3&&(t+=c()*100),a.health<.3&&(t+=c()*200);let i=S(e),n=c()<i?0:Math.floor(c()*(1-i)*500);for(let l in e.dependents)c()<1-e.dependents[l].conditions.health&&(t+=c()*200);return e.liabilities.healthInsurance<1&&(t=(t+n)*(c()*2+1.5)),m().totalMedicalFees+=t,t}function la(e){let t=e.assets.cash,a=ee(e),i=t>500?c()>(a>.75?.9:a>.5?.5:.2)?0:t*c()*a:0;e.assets.cash-=i,e.assets.investments+=i;let n=0,l=ae(e.liabilities);if(l>0){let o=l*c()*(1-a);n=c()>(a>.75?.15:a>.5?.35:a>.3?.75:.95)?0:o}if(n>0){let o=w(e,n);o&&(e=o,b.totalDiscretionary+=n)}return e}function xt(e){if(e.income>0){let t=na(e.income),a=m();a.totalTaxes+=t;let i=e.income-t;e.assets.cash+=i}return e}function sa(e){return e.assets.investments+=e.assets.investments*ra(),e.assets.investments<0&&(e.assets.investments=0),e}function oa(e){for(let t in e.assets.vehicles){let a=e.assets.vehicles[t];if(c()<a.maintenanceRisk){let i=c()*500+25|0,n=w(e,i);if(n)e=n,a.health=Math.min(1,a.health+.9*c());else if(a.health-=.3*c(),a.health<=0){a.health=0;let l=a.currentValue*.05|0;Z.releaseId(t),e.assets.cash+=l,delete e.assets.vehicles[t]}}}return e}function ca(e){e.birthDay===A()&&e.age++;for(let t in e.dependents)if(e.dependents[t].birthDay===A()&&(e.dependents[t].age++,!(e.dependents[t].age<=ia))){let a=U(e.dependents[t]);a&&he(a),delete e.dependents[t]}return e}function ha(e,t){b=m();let a=b.rules;for(let i in a.vehicleRules)a.vehicleRules[i].priceMax>=e.assets.vehicles[t].currentValue&&(e.assets.vehicles[t].health-=c()*e.assets.vehicles[t].maintenanceRisk,e.assets.vehicles[t].health<0&&(e.assets.vehicles[t].health=0));return e}function ua(e,t){b=m();let a=b.rules;for(let i in a.vehicleRules)a.vehicleRules[i].priceMax>e.assets.vehicles[t].currentValue&&(e.assets.vehicles[t].currentValue-=e.assets.vehicles[t].currentValue*a.vehicleRules[i].depreciationFirstYear,e.assets.vehicles[t].currentValue<0&&(e.assets.vehicles[t].currentValue=0));return e}function da(e,t){b=m();let a=b.rules;for(let i in a.vehicleRules)a.vehicleRules[i].priceMax>e.assets.vehicles[t].currentValue&&(e.assets.vehicles[t].currentValue-=e.assets.vehicles[t].currentValue*a.vehicleRules[i].depreciation,e.assets.vehicles[t].currentValue<0&&(e.assets.vehicles[t].currentValue=0));return e}function ma(e){let t=e.conditions;if(c()<(e.age/100)**10.5&&(t.health=0),c()<b.pathogenChance&&c()>.75&&(e.infected=1),e.infected&&(t.immunity=Math.max(0,t.immunity-c()*.05),t.health=Math.max(0,t.health-c()*.05),e.traits.anxiety=Math.min(1,e.traits.anxiety+c()*.08)),t.health<.01)return Ge(e.id),nt(e.id),!1;if(ke>0&&(t.anxiety=Math.min(1,t.anxiety*(1+c()*.05))),e.income>0&&(t.health<.1||t.immunity<.1)&&(e=ye(e)),c()>S(e)?t.health=Math.max(0,t.health-c()*4e-4):t.health=Math.min(1,t.health+c()*4e-4),e=ca(e),e.age>120&&(e.conditions={health:0,immunity:0,anxiety:0}),e=$e(e),e.netWorth=$(e),e.liabilities.healthInsurance<1){let a=S(e);(a>.7||a>.4&&c()>.6)&&(e=_e(e))}return e}function pa(e){let t=e.conditions,a=ee(e),i=S(e),n,l=(c()*1e3|0)*a;e.assets.cash<l&&e.assets.investments>=l&&(e.assets.investments-=l,e.assets.cash+=l),i<.4&&(n=w(e,yt(e)))&&(e=n,t.health=Math.min(1,t.health+.5),e.infected=0,t.immunity=Math.min(1,t.immunity+.5)),!Object.keys(e.assets.vehicles).length&&c()>i&&e.assets.cash>=Me()&&(e.assets.cash-=Me());let o=(i>.85?a<.25?100:a<.65?70:50:i>.65?a<.25?90:a<.65?70:40:a<.25?110:a<.65?80:40)|0;if(n=w(e,o),n||e.assets.cash>=o){e.assets.cash>=o?e.assets.cash-=o:e=n,t.health=Math.min(1,t.health+.05),t.anxiety=Math.max(0,t.anxiety-.05),t.immunity=Math.min(1,t.immunity+.05);for(let s in e.dependents){let r=e.dependents[s].conditions;r.health=Math.min(1,r.health+.05),r.anxiety=Math.max(0,r.anxiety-.05),r.immunity=Math.min(1,r.immunity+.05)}}else{t.health=Math.max(0,t.health-c()*.05),t.anxiety=Math.min(1,t.anxiety+c()*.05),t.immunity=Math.max(0,t.immunity-c()*.05);for(let s in e.dependents){let r=e.dependents[s].conditions;r.health=Math.max(0,r.health-c()*.05),r.anxiety=Math.max(0,r.anxiety-c()*.05),r.immunity=Math.max(0,r.immunity-c()*.05)}}if(e.relationships.spouse){if(e=Fe(e),c()>F(e)&&c()>.5){let s=pt(e.relationships.spouse);s&&(s.relationships.spouse=""),e.relationships.spouse=""}}else if(c()>.5&&(e=ta(e),e.relationships.spouse)){let s=pt(e.relationships.spouse);s&&(s.relationships.spouse=e.id)}return(e.creditScore>=800&&c()>a&&Object.keys(e.liabilities.credit).length<8||e.creditScore>=500&&Object.keys(e.liabilities.credit).length<4)&&(e=aa(e)),e}function fa(e){if(Ce(e),S(e)>.45){let t=e.traits,a=e.conditions;a.health+=c()*1e-4,a.immunity+=c()*1e-4,t.physical+=c()*1e-4,t.mental+=c()*2e-4,a.anxiety-=c()*5e-4,a.health=Math.min(1,a.health),a.immunity=Math.min(1,a.immunity),t.physical=Math.min(1,t.physical),t.mental=Math.min(1,t.mental),a.anxiety=Math.max(0,a.anxiety)}e.income>1?e=xt(e,"salary"):c()<=F(e)&&(e=Ne(e));for(let t in e.assets.vehicles){let a=e.assets.vehicles[t],i=0,n;if(e=ha(e,t),c()<1-a.health&&c()>.7&&(i=a.accidentMultiplier*Math.floor(c()*300),a.health=Math.max(0,a.health-c())),i&&(n=w(e,i))&&(e=n),a.health>.1){let l=Math.floor(c()*(1-a.health));(n=w(e,l))&&(e=n,a.health=Math.min(1,a.health+.2))}else a.health=0}return e}function ga(e){let t=Object.keys(e.assets.realEstate),a=Object.keys(e.liabilities.rentals),i=e.conditions,n=e.traits;return t.length&&c()>.5&&a.length&&(e=fe(e,a[0])),!t.length&&!a.length&&$(e)<1e4&&(i.anxiety=Math.min(1,i.anxiety+c()*.08),i.immunity=Math.min(1,i.immunity+c()*.08),n.physical=Math.max(0,n.physical-c()*.04),n.mental=Math.max(0,n.mental-c()*.04)),e=sa(e),(c()>F(e)&&c()>S(e)||e.assets.investments>1e6)&&c()>.7&&(e=ye(e)),e.assets.investments>0&&(e=xt(e,"dividends")),oa(e)}function ya(e){let t=Object.keys(e.assets.realEstate),a=Object.keys(e.liabilities.rentals),i=e.conditions,n=e.traits;t.length<c()*10&&(e=Le(e)),e.pregnant>0&&(e.pregnant++,n.physical=Math.max(.01,n.physical-c()*.001),n.mental=Math.max(.01,n.mental-c()*.002),(n.physical<.2&&c()>.5||e.pregnant===9)&&(e=We(e,e.relationships.spouseWithChild),e.pregnant=0,b.totalBirths++));for(let s in e.pets){let r=c()*100+75|0;w(e,r)&&(e.pets[s].health=Math.min(1,e.pets[s].health+.25))}for(let s in e.pets){let r=c()>.75?c()*900|0:0,h=w(e,r);if(h)e=h,e.pets[s].health=1,b.totalVetFees+=r;else{e.creditScore=Math.max(0,e.creditScore-5);let u=c()>.8?c()*.02:0;((e.pets[s].health-=u)<.01||e.pets[s].age>25)&&(O.releaseId(s),delete e.pets[s])}}let l=yt(e),o=w(e,l);if(o)e=o,e.infected=0;else{i.health=Math.max(0,i.health-c()*.003),i.immunity=Math.max(0,i.immunity-c()*.03),i.anxiety=Math.min(1,i.anxiety+c()*.08);for(let s in e.dependents){let r=e.dependents[s].conditions;r.anxiety=Math.min(1,r.anxiety+.001),c()>.5&&(r.health=Math.max(0,r.health-.002)),c()>.7&&(r.immunity=Math.max(0,r.immunity-.001))}c()>.6&&(e=Oe(e))}for(let s in e.liabilities.mortgages){let r=e.liabilities.mortgages[s].amount;e.assets.cash>r?(e.assets.cash-=r,e.creditScore=Math.min(1e3,e.creditScore+5),t.length>1&&c()>.6&&(e=G(e,s))):(e.creditScore=Math.max(0,e.creditScore-20),e=G(e,s))}for(let s in e.liabilities.unitFees){let r=e.liabilities.unitFees[s].amount;if(e.assets.cash>r)e.assets.cash-=r;else{e.creditScore=Math.max(0,e.creditScore-10);let h=e.assets.realEstate[s].currentValue-(e.assets.realEstate[s].currentValue-(e.liabilities.mortgages[s]?.principalPaid||0))-r;h>0&&(e.assets.cash+=h),delete e.liabilities.unitFees[s],delete e.liabilities.mortgages[s],delete e.assets.realEstate[s]}}for(let s in e.liabilities.rentals){let r=e.liabilities.rentals[s].amount+e.liabilities.rentals[s].rentalInsurance;e.assets.cash>r?e.assets.cash-=r:(e.creditScore=Math.max(0,e.creditScore-10),e=fe(e,s))}for(let s in e.liabilities.loans){let r=e.liabilities.loans[s];if(e.assets.cash>r.amount){e.assets.cash-=r.amount,r.principalPaid+=r.amount,r.amountOwing-=r.amount;let h=r.amountOwing*r.interestRate/12;r.interestAccrued+=h,r.amountOwing+=h}else e.creditScore=Math.max(0,e.creditScore-15),delete e.liabilities.loans[s]}for(let s in e.liabilities.credit){let r=e.liabilities.credit[s];if(e.assets.cash>=r.amount){e.assets.cash-=r.amount,r.amount=0,e.creditScore=Math.min(1e3,e.creditScore+3);let h=r.amount*parseFloat(r.interestRate)/12;r.amount+=h,r.interestAccrued+=h}else e.creditScore<500?delete e.liabilities.credit[s]:e.creditScore=Math.max(0,e.creditScore-5)}return la(e)}function xa(e){let t=e.pets;for(let o in t)(++t[o].age>25||t[o].health<.01)&&delete t[o];let a=ee(e),i=F(e);c()<1-a&&c()<1-i&&(e.pets=De(e.pets),e.creditScore>600&&(e=je(e)));for(let o in e.liabilities.rentals){let s=e.liabilities.rentals[o];s.amount*=1+gt,s.rentalInsurance*=1+gt}let n=Object.keys(e.assets.realEstate);if(n.length)for(let o of n){let s=e.assets.realEstate[o].propertyTaxes;if(e.assets.cash>=s)e.assets.cash-=s,b.totalTaxes+=s;else{if(e.creditScore=Math.max(0,e.creditScore-15),e.liabilities.mortgages[o]){let r=e.liabilities.mortgages[o],h=e.assets.realEstate[o].currentValue-(e.assets.realEstate[o].currentValue-r.principalPaid)-e.liabilities.unitFees[o].amount;h>0&&(e.assets.cash+=h)}delete e.liabilities.unitFees[o],delete e.liabilities.mortgages[o],delete e.assets.realEstate[o]}}let l=Object.keys(e.assets.vehicles);if(l.length)for(let o of l){let s=e.assets.vehicles[o];s.age++,e=s.age===1?ua(e,o):da(e,o);let r=s.maintenanceRisk*c()*150,h=w(e,r);h?(e=h,s.accidentMultiplier=0):(e.creditScore=Math.max(0,e.creditScore-5),s.accidentMultiplier=100)}return e}function va(e,t){for(let a in e){let i=e[a];if(!i||(i=ma(i),!i))return;A()%3===0&&(i=pa(i)),A()%15===0&&i&&(i=fa(i)),A()%90===0&&(i=ga(i)),A()%30===0&&(i=ya(i)),A()%360===0&&(i=xa(i))}}function Ma(e){if(e%(2*(10-b.simulationSpeed))===0){at(te(),A()),Ye(b.simulationSpeed);let t=k();if(Object.keys(t).length===0){population.textContent="Adult Population: 0";return}va(t,b),b=m(),rt(e,1e3/b.simulationSpeed),it()}return e%2===0&&mt(),e++,e}function vt(){ke=Ma(ke),requestAnimationFrame(vt)}vt();})();
